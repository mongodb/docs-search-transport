[
  {
    "$search": {
      "facet": {
        "operator": {
          "compound": {
            "should": [
              {
                "text": {
                  "query": ["drivers"],
                  "path": ["paragraphs", "code.lang", "code.value", "text"]
                }
              },
              {
                "text": {
                  "query": ["drivers"],
                  "path": "headings",
                  "score": { "boost": { "value": 5 } }
                }
              },
              {
                "text": {
                  "query": ["drivers"],
                  "path": "title",
                  "score": { "boost": { "value": 10 } }
                }
              },
              {
                "text": {
                  "query": ["drivers"],
                  "path": "tags",
                  "score": { "boost": { "value": 10 } }
                }
              }
            ],
            "minimumShouldMatch": 1
          }
        },
        "facets": {
          "genreFacet": { "type": "string", "path": "facets.products" },
          "productFacet": { "type": "string", "path": "facets.languages" }
        }
      }
    }
  },
  { "$match": { "includeInGlobalSearch": true } },
  {
    "$facet": {
      "docs": [
        {
          "$project": {
            "_id": 0,
            "title": 1,
            "preview": 1,
            "url": 1,
            "searchProperty": 1
          }
        }
      ],
      "meta": [{ "$replaceWith": "$$SEARCH_META" }, { "$limit": 1 }]
    }
  },
  { "$set": { "meta": { "$arrayElemAt": ["$meta", 0] } } }
]


